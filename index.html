<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rumshop — Minimal Online Store</title>
  <meta name="description" content="Rumshop — minimalist online store" />
  <style>
    /* ---------- Layout & UI ---------- */
    body { font-family: Arial, sans-serif; margin:0; background:#fff; color:#222; }
    header { background:#f8f8f8; padding:20px; position:sticky; top:0; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #ddd; }
    header h1 { margin:0; font-size:1.5rem; }
    nav a { margin-left:20px; text-decoration:none; color:#555; font-weight:bold; }
    nav a:hover { color:#000; }

    main { max-width:1100px; margin:40px auto; padding:0 20px; }
    .hero { text-align:center; margin-bottom:40px; }
    .hero h2 { font-size:2rem; margin:0 0 10px; }
    .hero p { color:#555; }

    .catalog { display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:20px; }

    .product {
      border:1px solid #eee;
      border-radius:8px;
      overflow:hidden;
      box-shadow:0 2px 6px rgba(0,0,0,0.05);
      text-align:center;
      padding:16px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .product img { width:100%; height:200px; object-fit:cover; cursor:pointer; transition:transform .25s; border-radius:6px; }
    .product img:hover { transform:scale(1.03); }
    .product h3 { margin:12px 0 6px; font-size:1.05rem; }
    .product p { color:#666; margin:0 0 10px; font-size:.95rem; min-height:40px; }
    .price { font-weight:bold; color:#000; margin-bottom:8px; }

    /* site-styled Buy Now buttons (teal) */
    .btn {
      background-color:#0b7285;
      color:#fff;
      border:none;
      padding:10px 16px;
      border-radius:6px;
      cursor:pointer;
      font-size:1rem;
      transition:background-color .2s;
      display:inline-block;
    }
    .btn:hover { background-color:#095e6d; }

    /* Contact form */
    form { display:flex; flex-direction:column; gap:10px; max-width:500px; margin:0 auto; }
    input, textarea { width:100%; box-sizing:border-box; padding:10px; border-radius:5px; border:1px solid #ccc; font-size:1rem; }
    textarea { height:100px; resize:none; }

    footer { background:#f8f8f8; padding:20px; text-align:center; color:#777; border-top:1px solid #ddd; }

    /* Modal (image zoom) */
    .modal { display:none; position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,.85); align-items:center; justify-content:center; padding:20px; }
    .modal img { max-width:95%; max-height:85%; border-radius:6px; }
    .modal .close { position:absolute; top:18px; right:24px; color:#fff; font-size:34px; cursor:pointer; }

    /* temporary inline PayPal container (hidden) */
    #paypal-temp { position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); z-index:3000; background:#fff; padding:18px; border-radius:8px; box-shadow:0 10px 30px rgba(0,0,0,0.2); display:none; }
  </style>
</head>
<body>
  <header>
    <h1>Rumshop</h1>
    <nav>
      <a href="#home">Home</a>
      <a href="#catalog">Catalogue</a>
      <a href="#contact">Contact</a>
    </nav>
  </header>

  <main>
    <section id="home" class="hero">
      <h2>Welcome to Rumshop</h2>
      <p>Only Selected Retro Stuff</p>
    </section>

    <section id="catalog">
      <h2>Product Catalogue</h2>
      <div class="catalog">

        <!-- Product 1 -->
        <div class="product" data-title="Retro Square Electronic Watch. Unisex" data-price="5.99">
          <img src="images/product1.jpg" alt="Retro Square Electronic Watch" class="clickable-img">
          <h3>Retro Square Electronic Watch. Unisex</h3>
          <p>Classic Electronic Digital Display Watch from our Childhood.</p>
          <div class="price">$5.99</div>
          <button class="btn buy-now">Buy Now</button>
        </div>

        <!-- Product 2 -->
        <div class="product" data-title="Motorola RAZR V3i" data-price="15.99">
          <img src="images/product2.jpg" alt="Motorola RAZR V3i" class="clickable-img">
          <h3>Motorola RAZR V3i</h3>
          <p>That "Show off" pocket flip mobile phone we all loved.</p>
          <div class="price">$15.99</div>
          <button class="btn buy-now">Buy Now</button>
        </div>

      </div>
    </section>

    <section id="contact">
      <h2>Contact Us</h2>
      <p>Have questions? Get in touch using the form below.</p>
      <form>
        <input type="text" placeholder="Your Name" required>
        <input type="email" placeholder="Your Email" required>
        <textarea placeholder="Your Message" required></textarea>
        <button type="submit" class="btn">Send Message</button>
      </form>
    </section>
  </main>

  <footer><p>© 2025 Rumshop — Minimal Online Store</p></footer>

  <!-- Image modal -->
  <div id="imgModal" class="modal" aria-hidden="true">
    <span class="close" id="modalClose">&times;</span>
    <img id="modalImg" src="" alt="Expanded image">
  </div>

  <!-- Temporary PayPal container used to render button and open popup -->
  <div id="paypal-temp"></div>

  <!-- PayPal SDK (client-id inserted once) -->
  <script src="https://www.paypal.com/sdk/js?client-id=AcHd6A2M8rLgNdUHAqQEO1FUA_bTk02T5Aldto7iDos-DNdaxuO1l0U798No3wOHUNuOIuhTy7EXqgAh&currency=USD"></script>

  <script>
  (function () {
    // ---------- Utilities ----------
    function $(sel, ctx){ return (ctx || document).querySelector(sel); }
    function $all(sel, ctx){ return Array.from((ctx || document).querySelectorAll(sel)); }

    // ---------- Image modal ----------
    const modal = $('#imgModal');
    const modalImg = $('#modalImg');
    const modalClose = $('#modalClose');

    $all('.clickable-img').forEach(img => {
      img.addEventListener('click', () => {
        modalImg.src = img.src;
        modal.style.display = 'flex';
        modal.setAttribute('aria-hidden', 'false');
      });
    });
    modalClose.addEventListener('click', () => { modal.style.display = 'none'; modal.setAttribute('aria-hidden','true'); });
    modal.addEventListener('click', (e) => { if (e.target === modal) { modal.style.display='none'; modal.setAttribute('aria-hidden','true'); } });

    // ---------- PayPal flow ----------
    // Buttons are per-product UI elements. When clicked, we:
    // 1) open a small temporary container
    // 2) render a PayPal button into it that creates an order for that product
    // 3) PayPal opens the pop-up (no full-page redirect) and allows PayPal or Card
    // 4) cleanup the temporary container after success/cancel/error
    const buyButtons = $all('.buy-now');
    const tempContainer = $('#paypal-temp');

    // wait until paypal is available
    function waitForPaypal(cb, timeoutMs = 5000) {
      const start = Date.now();
      (function check(){
        if (window.paypal) return cb(null);
        if (Date.now() - start > timeoutMs) return cb(new Error('PayPal SDK load timed out.'));
        setTimeout(check, 50);
      })();
    }

    // Render a temporary PayPal button and open the popup
    function openCheckout(product) {
      // show container
      tempContainer.style.display = 'block';
      tempContainer.innerHTML = ''; // clear
      // render into temporary container
      const renderTarget = document.createElement('div');
      renderTarget.id = 'paypal-render-' + Math.random().toString(36).slice(2);
      tempContainer.appendChild(renderTarget);

      // Render PayPal button
      const button = paypal.Buttons({
        style: { color: 'blue', shape: 'rect', label: 'buynow', height: 40 },
        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{
              description: product.title,
              amount: { value: product.price }
            }]
          });
        },
        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            // success message (use payer name if available)
            const payerName = (details && details.payer && details.payer.name && details.payer.name.given_name) ? details.payer.name.given_name : '';
            alert('Thank you ' + (payerName || '') + '! Your payment for ' + product.title + ' was successful.');
            cleanup();
          });
        },
        onCancel: function() { cleanup(); },
        onError: function(err) {
          console.error('PayPal error:', err);
          alert('Payment error occurred. Please try again.');
          cleanup();
        }
      });

      // render and automatically open PayPal checkout popup when user clicks the rendered button
      button.render('#' + renderTarget.id).catch(err => {
        console.error('Render error', err);
        alert('Could not render PayPal button. See console for details.');
        cleanup();
      });

      // helper: remove temp container and hide
      function cleanup() {
        try { button.close && button.close(); } catch(e){}
        tempContainer.innerHTML = '';
        tempContainer.style.display = 'none';
      }
    }

    // attach click handlers to Buy Now buttons
    buyButtons.forEach(btn => {
      btn.addEventListener('click', (e) => {
        const card = e.target.closest('.product');
        const title = card.dataset.title || card.querySelector('h3').innerText;
        const price = card.dataset.price || (card.querySelector('.price') ? card.querySelector('.price').innerText.replace(/[^0-9.]/g,'') : '0.00');
        const product = { title: title, price: price };
        // wait for paypal loaded
        waitForPaypal(function(err){
          if (err) {
            console.error(err);
            alert('PayPal SDK failed to load. Open the browser console to troubleshoot.');
            return;
          }
          openCheckout(product);
        }, 7000);
      });
    });

    // Accessibility: close paypal-temp with ESC (cleanup)
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') { $('#paypal-temp').innerHTML=''; $('#paypal-temp').style.display='none'; }
    });

  })();
  </script>
</body>
</html>
